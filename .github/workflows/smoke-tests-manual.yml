name: Smoke Tests (Manual)

# Do not edit - generated by `generateCIActions` Gradle task.

on:
  workflow_dispatch:
    inputs:
      suites:
        type: string
        required: false
        default: 'acceptance,type-mapping,gradle,lib-0-499,lib-500-999,lib-1000-1499,lib-1500-1999,lib-2000-2499,lib-2500-2999,lib-3000-3499,lib-3500-3999,lib-4000-4499,lib-4500-4999,lib-5000-5499,lib-5500-5999,lib-6000-6499,lib-6500-6735'
        description: |
          Comma-separated test suites to run. Available: acceptance, type-mapping, gradle, lib-0-499, lib-500-999, lib-1000-1499, lib-1500-1999, lib-2000-2499, lib-2500-2999, lib-3000-3499, lib-3500-3999, lib-4000-4499, lib-4500-4999, lib-5000-5499, lib-5500-5999, lib-6000-6499, lib-6500-6735
          Leave empty to run all. Use '!' prefix to exclude (e.g., '!lib-0-499').
      kotlin_version_name:
        type: string
        required: false
        description:
          'The name of the supported Kotlin version (SKIE flavor) to test. Latest supported version is used for all tests if not specified.'
      compiler_version:
        type: string
        required: false
        description:
          'The Kotlin compiler version used by the tests. Defaults to compiler version of the selected Kotlin version name if not specified. If specified, the Kotlin version name must be specified as well.'
      linkage:
        type: choice
        options:
          - static
          - dynamic
        required: true
        default: static
        description:
          'The linkage mode to use for the tests. "static" will produce static frameworks, "dynamic" will produce dynamic frameworks.'
      configuration:
        type: choice
        options:
          - debug
          - release
        required: true
        default: debug
        description:
          'The configuration to use for the tests. "release" will produce release builds, "debug" will produce debug builds (type mapping tests currently always use release).'
      target:
        type: choice
        options:
          - ios_arm64
          - ios_x64
          - ios_simulator_arm64
          - macos_arm64
          - macos_x64
        required: true
        default: macos_arm64
        description:
          'The target to use for the type mapping tests.'

concurrency:
  group: ci-smoke-tests-manual
  cancel-in-progress: false

permissions:
  contents: read
  checks: write

jobs:
  acceptance-tests:
    name: Acceptance Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }})
    if: |-
      (!inputs.suites || (contains(inputs.suites, 'acceptance') && !contains(inputs.suites, '!acceptance')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run Acceptance Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:functional:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - Functional Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/functional__*/TEST-*.xml'
      #     require_tests: true

  gradle-tests:
    name: Gradle Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }})
    runs-on: self-hosted
    needs: [acceptance-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'gradle') && !contains(inputs.suites, '!gradle')))
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run Gradle Tests
        uses: gradle/gradle-build-action@v2.4.2
        id: run-tests
#      TODO The targets cannot be selected at the moment due to a mismatch in the name used by Gradle and other kinds of tests
#      "-Pmatrix.targets=${{ inputs.target || 'macosArm64' }}"
        with:
          arguments: >-
            :test
            -PtestLevel=smoke
            -PtestType=gradle
            "-Pmatrix.targets=macosArm64"
            "-Pmatrix.configurations=${{ inputs.configuration || 'debug' }}"
            "-Pmatrix.linkModes=${{ inputs.linkage || 'static' }}"
            "-PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: test-runner
      - name: Publish Test Report
        uses: mikepenz/action-junit-report@v4
        if: ${{ failure() || success() }}
        with:
          check_name: "Smoke Test Reports - Gradle Tests"
          report_paths: 'test-runner/build/test-results/test/TEST-*.xml'
          require_tests: true

  type-mapping-tests:
    name: Type Mapping Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }})
    runs-on: self-hosted
    needs: [gradle-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'type-mapping') && !contains(inputs.suites, '!type-mapping')))
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run Type Mapping Tests
        uses: gradle/gradle-build-action@v2.4.2
        id: run-tests
        with:
          arguments: ":acceptance-tests:type-mapping:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_TARGET: ${{ inputs.target }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ (failure() || success()) && steps.run-tests.outcome != 'skipped' }}
      #   with:
      #     check_name: "Smoke Test Reports - Type Mapping Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/type-mapping__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-0-499:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 0-499
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-0-499') && !contains(inputs.suites, '!lib-0-499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "0-499"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-500-999:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 500-999
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-500-999') && !contains(inputs.suites, '!lib-500-999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "500-999"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-1000-1499:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 1000-1499
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-1000-1499') && !contains(inputs.suites, '!lib-1000-1499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "1000-1499"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-1500-1999:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 1500-1999
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-1500-1999') && !contains(inputs.suites, '!lib-1500-1999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "1500-1999"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-2000-2499:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 2000-2499
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-2000-2499') && !contains(inputs.suites, '!lib-2000-2499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "2000-2499"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-2500-2999:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 2500-2999
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-2500-2999') && !contains(inputs.suites, '!lib-2500-2999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "2500-2999"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-3000-3499:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 3000-3499
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-3000-3499') && !contains(inputs.suites, '!lib-3000-3499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "3000-3499"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-3500-3999:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 3500-3999
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-3500-3999') && !contains(inputs.suites, '!lib-3500-3999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "3500-3999"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-4000-4499:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 4000-4499
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-4000-4499') && !contains(inputs.suites, '!lib-4000-4499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "4000-4499"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-4500-4999:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 4500-4999
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-4500-4999') && !contains(inputs.suites, '!lib-4500-4999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "4500-4999"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-5000-5499:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 5000-5499
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-5000-5499') && !contains(inputs.suites, '!lib-5000-5499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "5000-5499"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-5500-5999:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 5500-5999
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-5500-5999') && !contains(inputs.suites, '!lib-5500-5999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "5500-5999"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-6000-6499:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 6000-6499
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-6000-6499') && !contains(inputs.suites, '!lib-6000-6499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "6000-6499"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
  
  external-libraries-tests-6500-6735:
    name: External Libraries Tests (${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}) 6500-6735
    needs: [type-mapping-tests]
    if: |
      always() &&
      (!inputs.suites || (contains(inputs.suites, 'lib-6500-6735') && !contains(inputs.suites, '!lib-6500-6735')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=${{ inputs.kotlin_version_name && (inputs.compiler_version && format('{0}[{1}]', inputs.kotlin_version_name, inputs.compiler_version) || inputs.kotlin_version_name) || '2.2.20' }}"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "6500-6735"
      # Log size can be too large which causes significant performance issues
      # - name: Publish Test Report
      #   uses: mikepenz/action-junit-report@v3
      #   if: ${{ failure() || success() }}
      #   with:
      #     check_name: "Smoke Test Reports - External Libraries Tests"
      #     report_paths: 'SKIE/acceptance-tests/build/test-results/libraries__*/TEST-*.xml'
      #     require_tests: true
