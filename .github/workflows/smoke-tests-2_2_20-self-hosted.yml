name: Smoke Tests 2.2.20 [self-hosted]

# Do not edit - generated by `generateCIActions` Gradle task.

on:  
  schedule:
    # Every Saturday at 12am EST
    - cron: '0 5 * * SAT'
  workflow_dispatch:
    inputs:
      suites:
        type: string
        required: false
        default: 'acceptance,type-mapping,gradle,lib-0-499,lib-500-999,lib-1000-1499,lib-1500-1999,lib-2000-2499,lib-2500-2999,lib-3000-3499,lib-3500-3999,lib-4000-4499,lib-4500-4999,lib-5000-5499,lib-5500-5999,lib-6000-6499,lib-6500-6734'
        description: |
          Comma-separated test suites to run. Available: acceptance, type-mapping, gradle, lib-0-499, lib-500-999, lib-1000-1499, lib-1500-1999, lib-2000-2499, lib-2500-2999, lib-3000-3499, lib-3500-3999, lib-4000-4499, lib-4500-4999, lib-5000-5499, lib-5500-5999, lib-6000-6499, lib-6500-6734
          Leave empty to run all. Use '!' prefix to exclude (e.g., '!lib-0-499').
      compiler_version:
        type: string
        required: true
        default: '2.2.20'
        description:
          'The Kotlin compiler version used by the tests.'
      linkage:
        type: choice
        options:
          - static
          - dynamic
        required: true
        default: static
        description:
          'The linkage mode to use for the tests. "static" will produce static frameworks, "dynamic" will produce dynamic frameworks.'
      configuration:
        type: choice
        options:
          - debug
          - release
        required: true
        default: debug
        description:
          'The configuration to use for the tests. "release" will produce release builds, "debug" will produce debug builds (type mapping tests currently always use release).'
      target:
        type: choice
        options:
          - ios_arm64
          - ios_x64
          - ios_simulator_arm64
          - macos_arm64
          - macos_x64
        required: true
        default: macos_arm64
        description:
          'The target to use for the type mapping tests.'

permissions:
  contents: read
  checks: write

jobs:
  acceptance-tests:
    name: Acceptance Tests 2.2.20[${{ inputs.compiler_version || '2.2.20' }}]
    if: |-
      (!inputs.suites || (contains(inputs.suites, 'acceptance') && !contains(inputs.suites, '!acceptance')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run Acceptance Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:functional:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}

  gradle-tests:
    name: Gradle Tests 2.2.20[${{ inputs.compiler_version || '2.2.20' }}]
    if: |
      (!inputs.suites || (contains(inputs.suites, 'gradle') && !contains(inputs.suites, '!gradle')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run Gradle Tests
        uses: gradle/gradle-build-action@v2.4.2
        id: run-tests
#      TODO The targets cannot be selected at the moment due to a mismatch in the name used by Gradle and other kinds of tests
#      "-Pmatrix.targets=${{ inputs.target || 'macosArm64' }}"
        with:
          arguments: >-
            :test
            -PtestLevel=smoke
            -PtestType=gradle
            "-Pmatrix.targets=macosArm64"
            "-Pmatrix.configurations=${{ inputs.configuration || 'debug' }}"
            "-Pmatrix.linkModes=${{ inputs.linkage || 'static' }}"
            "-PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: test-runner
      - name: Publish Test Report
        uses: mikepenz/action-junit-report@v4
        if: ${{ failure() || success() }}
        with:
          check_name: "Smoke Test Reports - Gradle Tests"
          report_paths: 'test-runner/build/test-results/test/TEST-*.xml'
          require_tests: true

  type-mapping-tests:
    name: Type Mapping Tests 2.2.20[${{ inputs.compiler_version || '2.2.20' }}]
    if: |
      (!inputs.suites || (contains(inputs.suites, 'type-mapping') && !contains(inputs.suites, '!type-mapping')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run Type Mapping Tests
        uses: gradle/gradle-build-action@v2.4.2
        id: run-tests
        with:
          arguments: ":acceptance-tests:type-mapping:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_TARGET: ${{ inputs.target }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
  
  external-libraries-tests-0-499:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 0-499
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-0-499') && !contains(inputs.suites, '!lib-0-499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "0-499"
  
  external-libraries-tests-500-999:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 500-999
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-500-999') && !contains(inputs.suites, '!lib-500-999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "500-999"
  
  external-libraries-tests-1000-1499:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 1000-1499
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-1000-1499') && !contains(inputs.suites, '!lib-1000-1499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "1000-1499"
  
  external-libraries-tests-1500-1999:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 1500-1999
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-1500-1999') && !contains(inputs.suites, '!lib-1500-1999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "1500-1999"
  
  external-libraries-tests-2000-2499:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 2000-2499
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-2000-2499') && !contains(inputs.suites, '!lib-2000-2499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "2000-2499"
  
  external-libraries-tests-2500-2999:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 2500-2999
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-2500-2999') && !contains(inputs.suites, '!lib-2500-2999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "2500-2999"
  
  external-libraries-tests-3000-3499:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 3000-3499
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-3000-3499') && !contains(inputs.suites, '!lib-3000-3499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "3000-3499"
  
  external-libraries-tests-3500-3999:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 3500-3999
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-3500-3999') && !contains(inputs.suites, '!lib-3500-3999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "3500-3999"
  
  external-libraries-tests-4000-4499:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 4000-4499
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-4000-4499') && !contains(inputs.suites, '!lib-4000-4499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "4000-4499"
  
  external-libraries-tests-4500-4999:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 4500-4999
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-4500-4999') && !contains(inputs.suites, '!lib-4500-4999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "4500-4999"
  
  external-libraries-tests-5000-5499:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 5000-5499
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-5000-5499') && !contains(inputs.suites, '!lib-5000-5499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "5000-5499"
  
  external-libraries-tests-5500-5999:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 5500-5999
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-5500-5999') && !contains(inputs.suites, '!lib-5500-5999')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "5500-5999"
  
  external-libraries-tests-6000-6499:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 6000-6499
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-6000-6499') && !contains(inputs.suites, '!lib-6000-6499')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "6000-6499"
  
  external-libraries-tests-6500-6734:
    name: External Libraries Tests (2.2.20[${{ inputs.compiler_version || '2.2.20' }}]) 6500-6734
    if: |
      (!inputs.suites || (contains(inputs.suites, 'lib-6500-6734') && !contains(inputs.suites, '!lib-6500-6734')))
    runs-on: self-hosted
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3
        with:
          submodules: true
          token: ${{ secrets.ACCEPTANCE_TESTS_TOKEN }}
      - name: Prepare Worker
        uses: ./.github/actions/prepare-worker
      - name: Run External Libraries Tests
        uses: gradle/gradle-build-action@v2.4.2
        with:
          arguments: ":acceptance-tests:libraries:test -PversionSupport.kotlin.enabledVersions=2.2.20[${{ inputs.compiler_version || '2.2.20' }}]"
          build-root-directory: SKIE
        env:
          KOTLIN_LINK_MODE: ${{ inputs.linkage }}
          KOTLIN_BUILD_CONFIGURATION: ${{ inputs.configuration }}
          onlyIndices: "6500-6734"
